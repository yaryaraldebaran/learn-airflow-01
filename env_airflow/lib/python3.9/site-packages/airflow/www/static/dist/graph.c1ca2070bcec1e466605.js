/*! For license information please see graph.c1ca2070bcec1e466605.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Airflow=t():(e.Airflow=e.Airflow||{},e.Airflow.graph=t())}(self,(()=>(()=>{"use strict";var e={4965:(e,t,a)=>{a.d(t,{dagTZ:()=>i});var n=a(8956),o=a(1068),r=a(3307);const d=(0,n.au)("dag_id"),s=(0,n.au)("paused_url"),i=(0,n.au)("dag_timezone"),l=(0,n.au)("datasets_url"),c={createAfter:(0,n.au)("next_dagrun_create_after"),intervalStart:(0,n.au)("next_dagrun_data_interval_start"),intervalEnd:(0,n.au)("next_dagrun_data_interval_end")};let u,m=[];const p=(e,t)=>{m=e,u=t};$(window).on("load",(function(){$(`a[href*="${this.location.pathname}"]`).parent().addClass("active"),$(".never_active").removeClass("active");const e=$("#next-dataset-tooltip");$(e).data("uri")||(0,r.l)(d,e,p)})),$("#pause_resume").on("change",(function(){const e=$(this),t=e.data("dag-id"),a=e.is(":checked"),n=`${s}?is_paused=${a}&dag_id=${encodeURIComponent(t)}`;e.trigger("blur"),e.removeClass("switch-input--error");const o=new CustomEvent("paused",{detail:a});document.dispatchEvent(o),$.post(n).fail((()=>{setTimeout((()=>{e.prop("checked",!a),e.addClass("switch-input--error"),o.value=!a,document.dispatchEvent(o)}),500)}))})),$("#next-run").on("mouseover",(()=>{$("#next-run").attr("data-original-title",(()=>{let e="";return c.createAfter&&(e+=`<strong>Run After:</strong> ${(0,o.o0)(c.createAfter)}<br>`,e+=`Next Run: ${(0,o.K5)(c.createAfter)}<br><br>`),c.intervalStart&&c.intervalEnd&&(e+="<strong>Data Interval</strong><br>",e+=`Start: ${(0,o.o0)(c.intervalStart)}<br>`,e+=`End: ${(0,o.o0)(c.intervalEnd)}`),e}))})),$(".next-dataset-triggered").on("click",(e=>{const t=$("#next-dataset-tooltip"),a=$(e.target).data("summary"),n=$(t).data("uri");n?window.location.href=`${l}?uri=${encodeURIComponent(n)}`:(0,r.R)(d,a,m,u)}))},3307:(e,t,a)=>{a.d(t,{R:()=>o,l:()=>r});var n=a(8956);function o(e,t="",a=[],o=null){const r=(0,n.au)("datasets_url");$("#datasets_tbody").empty(),$("#datasets_error").hide(),$("#dag_id").text(e),$("#datasetNextRunModal").modal({}),$("#next_run_summary").text(t),a.forEach((e=>{const t=document.createElement("tr"),a=document.createElement("td"),n=document.createElement("a");n.href=`${r}?uri=${encodeURIComponent(e.uri)}`,n.innerText=e.uri,a.append(n);const o=document.createElement("td");e.lastUpdate&&o.append(isoDateToTimeEl(e.lastUpdate)),t.append(a),t.append(o),$("#datasets_tbody").append(t)})),o&&($("#datasets_error_msg").text(o),$("#datasets_error").show())}function r(e,t,a){let o=(0,n.au)("next_run_datasets_url");e&&(o.includes("__DAG_ID__")&&(o=o.replace("__DAG_ID__",e)),$.get(o).done((e=>{let n=0,o="<strong>Pending datasets:</strong><br>";a(e),e.forEach((e=>{e.created_at||(n<4&&(o+=`${e.uri}<br>`),n+=1)})),n>4&&(o+=`<br>And ${n-4} more.`),o+="<br>Click to see more details.",$(t).attr("data-original-title",(()=>o))})).fail(((e,t,n)=>{const o=e.responseJSON&&e.responseJSON.error||"Something went wrong.";a([],`${t}: ${n} ${o}`)})))}},1068:(e,t,a)=>{a.d(t,{$O:()=>s,K5:()=>m,M1:()=>i,n0:()=>l,o0:()=>c,oY:()=>u,sK:()=>n,z6:()=>d});const n="YYYY-MM-DD, HH:mm:ss",o="YYYY-MM-DD, HH:mm:ss z",r="z (Z)",d="YYYY-MM-DDThh:mm:ssTZD",s="timezone";function i(e){return e instanceof moment?e.isUTC()?"UTC":e.format(r):"UTC"===e?e:moment().tz(e).format(r)}function l(e,t){const a=moment(e),o=$.extend({title:!0},t).title,r=document.createElement("time");return r.setAttribute("datetime",a.format()),o&&r.setAttribute("title",a.isUTC()?"":`UTC: ${a.clone().utc().format()}`),r.innerText=a.format(n),r}const c=e=>moment(e).format(o);function u(e){moment.tz.setDefault(e),$('time[data-datetime-convert!="false"]').each(((e,t)=>{const a=$(t),r=moment(a.attr("datetime"));r._isValid&&a.text(r.format(a.data("with-tz")?o:n)),void 0!==a.attr("title")&&a.attr("title",r.isUTC()?"":`UTC: ${r.clone().utc().format()}`)})),$(".datetime input").each(((e,t)=>{t.value=moment(t.value).format()}))}const m=e=>`${moment(e).fromNow()}`},5122:(e,t,a)=>{a.d(t,{escapeHtml:()=>s});var n=a(1068);function o(){const e=moment();$("#clock").attr("datetime",e.format(n.z6)).html(`${e.format("HH:mm")} <strong>${(0,n.M1)(e)}</strong>`)}function r(e){localStorage.setItem("selected-timezone",e);const t=new CustomEvent(n.$O,{detail:e});document.dispatchEvent(t),(0,n.oY)(e),o(),$("body").trigger({type:"airflow.timezone-change",timezone:e})}window.isoDateToTimeEl=n.n0,window.moment=Airflow.moment;const d=document.createElement("span");function s(e){return d.textContent=e,d.innerHTML}function i(e){const t=$(e),a=$(".filter_val.form-control",t.parents("tr"));"Is Null"===t.text()||"Is not Null"===t.text()?(void 0!==a.attr("required")&&(a.removeAttr("required"),a.attr("airflow-required",!0)),1===a.parent(".datetime").length?a.parent(".datetime").hide():a.hide()):("true"===a.attr("airflow-required")&&(a.attr("required",!0),a.removeAttr("airflow-required")),1===a.parent(".datetime").length?a.parent(".datetime").show():a.show())}window.escapeHtml=s,window.convertSecsToHumanReadable=function(e){const t=e,a=t-Math.floor(t);e=Math.floor(e);const n=Math.floor(e/3600);e-=3600*n;const o=Math.floor(e/60);let r="";return n>0&&(r+=`${n}Hours `),o>0&&(r+=`${o}Min `),(e-=60*o)+a>0&&(Math.floor(t)===t?r+=`${e}Sec`:r+=`${(e+=a).toFixed(3)}Sec`),r},window.postAsForm=function(e,t){const a=$("<form></form>");a.attr("method","POST"),a.attr("action",e),$.each(t||{},((e,t)=>{const n=$("<input></input>");n.attr("type","hidden"),n.attr("name",e),n.attr("value",t),a.append(n)}));const n=$("<input></input>");n.attr("type","hidden"),n.attr("name","csrf_token"),n.attr("value",csrfToken),a.append(n),$(document.body).append(a),a.submit()},$(document).ready((()=>{!function(){const e=moment.tz.guess(),t=localStorage.getItem("selected-timezone"),a=localStorage.getItem("chosen-timezone");function o(t){localStorage.setItem("chosen-timezone",t),t!==e||t!==Airflow.serverTimezone?($("#timezone-manual a").data("timezone",t).text((0,n.M1)(t)),$("#timezone-manual").show()):$("#timezone-manual").hide()}a&&o(a),r(t||Airflow.defaultUITimezone),"UTC"!==Airflow.serverTimezone&&($("#timezone-server a").html(`${(0,n.M1)(Airflow.serverTimezone)} <span class="label label-primary">Server</span>`),$("#timezone-server").show()),Airflow.serverTimezone!==e?$("#timezone-local a").attr("data-timezone",e).html(`${(0,n.M1)(e)} <span class="label label-info">Local</span>`):$("#timezone-local").hide(),$("a[data-timezone]").click((e=>{r($(e.currentTarget).data("timezone"))})),$("#timezone-other").typeahead({source:$(moment.tz.names().map((e=>({category:e.split("/",1)[0],name:e.replace("_"," "),tzName:e})))),showHintOnFocus:"all",showCategoryHeader:!0,items:"all",afterSelect(e){this.$element.val(""),o(e.tzName),r(e.tzName),setTimeout((()=>{document.activeElement.blur(),this.shown=!1,this.focused=!1}),1)}})}(),$("#clock").attr("data-original-title",hostName).attr("data-placement","bottom").parent().show(),o(),setInterval(o,1e3),$.ajaxSetup({beforeSend(e,t){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(t.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",csrfToken)}}),$.fn.datetimepicker.defaults.sideBySide=!0,$(".datetimepicker").datetimepicker({format:"YYYY-MM-DDTHH:mm:ssZ"}),$(".filters .select2-chosen").each(((e,t)=>{i(t)})),$(".filters .select2-chosen").on("DOMNodeInserted",(e=>{i(e.target)})),$("#filter_form a.filter").click((()=>{$(".datetimepicker").datetimepicker(),$(".filters .select2-chosen").on("DOMNodeInserted",(e=>{i(e.target)}))})),$(".js-tooltip").tooltip()}))},3897:(e,t,a)=>{a.d(t,{default:()=>i,taskNoInstanceTooltip:()=>l});var n=a(5122),o=a(1068),r=a(4965),d=a(8956);function s(e,t){const a=t&&t instanceof moment&&t.isValid();return`Started: ${e.format(o.sK)}<br>Ended: ${a?t.format(o.sK):"Not ended yet"}<br>`}function i(e,t,{includeTryNumber:a=!1}={}){let i="";if(void 0!==e.state&&(i+=`<strong>Status:</strong> ${(0,n.escapeHtml)(e.state)}<br><br>`),e.mapped_states){const t=(0,d.Z2)();e.mapped_states.forEach((e=>{const a=e||"no_status";t.has(a)&&t.set(a,t.get(a)+1)})),i+=`<strong>${(0,n.escapeHtml)(e.mapped_states.length)} ${1===e.mapped_states.length?"Task":"Tasks"} Mapped</strong><br />`,t.forEach(((e,t)=>{e>0&&(i+=`<span style="margin-left: 15px">${(0,n.escapeHtml)(t)}: ${(0,n.escapeHtml)(e)}</span><br />`)})),i+="<br />"}if(void 0!==e.task_id&&(i+=`Task_id: ${(0,n.escapeHtml)(e.task_id)}<br>`),i+=`Run: ${(0,o.o0)(e.execution_date)}<br>`,void 0!==e.run_id&&(i+=`Run Id: <nobr>${(0,n.escapeHtml)(e.run_id)}</nobr><br>`),e.map_index>=0&&!e.mapped_states&&(i+=`Map Index: ${(0,n.escapeHtml)(e.map_index)}<br>`),void 0!==e.operator&&(i+=`Operator: ${(0,n.escapeHtml)(e.operator)}<br>`),t&&t.trigger_rule&&(i+=`Trigger Rule: ${t.trigger_rule}<br>`),"running"===e.state){const t=e.start_date instanceof moment?e.start_date:moment(e.start_date);e.duration=moment().diff(t,"second")}else if(!e.duration&&e.end_date){const t=e.start_date instanceof moment?e.start_date:moment(e.start_date),a=e.end_date instanceof moment?e.end_date:moment(e.end_date);e.duration=moment(a).diff(t,"second")}i+=`Duration: ${(0,n.escapeHtml)(convertSecsToHumanReadable(e.duration))}<br>`;const l=e.data_interval_start,c=e.data_interval_end;return l&&c&&(i+="<br><strong>Data Interval:</strong><br>",i+=`Start: ${(0,o.o0)(l)}<br>`,i+=`End: ${(0,o.o0)(c)}<br>`),a&&(i+=`Try Number: ${(0,n.escapeHtml)(e.try_number)}<br>`),i+=function(e,t,a){if(!e)return"<br><em>Not yet started</em>";const n="z (Z)",o=moment.defaultZone.name.toUpperCase(),r=moment.utc(e),d=moment.utc(t),i=a.toUpperCase();let l="<br><strong>UTC:</strong><br>";l+=s(r,d),"UTC"!==o&&(r.tz(o),l+=`<br><strong>Local: ${r.format(n)}</strong><br>`,l+=s(r,d&&d instanceof moment?d.tz(o):d));"UTC"!==i&&i!==o&&(r.tz(i),l+=`<br><strong>DAG's TZ: ${r.format(n)}</strong><br>`,l+=s(r,d&&d instanceof moment?d.tz(i):d));return l}(e.start_date,e.end_date,r.dagTZ||"UTC"),i}function l(e,t){let a="";return e&&(a+=`Task_id: ${(0,n.escapeHtml)(e)}<br>`),void 0!==t.task_type&&(a+=`Operator: ${(0,n.escapeHtml)(t.task_type)}<br>`),a+="<br><em>DAG has yet to run.</em>",a}window.tiTooltip=i,window.taskNoInstanceTooltip=l},8956:(e,t,a)=>{a.d(t,{Z2:()=>o,au:()=>n});function n(e){const t=document.querySelector(`meta[name="${e}"]`);return t&&t.getAttribute("content")||""}const o=()=>new Map([["success",0],["failed",0],["upstream_failed",0],["up_for_retry",0],["up_for_reschedule",0],["running",0],["deferred",0],["queued",0],["scheduled",0],["skipped",0],["no_status",0]])}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,a),r.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{a.r(n);var e=a(8956),t=a(5122),o=a(3897),r=a(1068);const d=(0,e.au)("dag_id"),s=(0,e.au)("logs_with_metadata_url"),i=(0,e.au)("external_log_url"),l=(0,e.au)("extra_links_url"),c="True"===(0,e.au)("show_external_log_redirect"),u=Array.from(document.querySelectorAll('a[id^="btn_"][data-base-url]')).reduce(((e,t)=>(e[t.id.replace("btn_","")]=t,e)),{});function m(e,t){let a=e.dataset.baseUrl;t.dag_id&&-1!==e.dataset.baseUrl.indexOf(d)&&(a=a.replace(d,t.dag_id),delete t.dag_id),Object.prototype.hasOwnProperty.call(t,"map_index")&&void 0===t.map_index&&delete t.map_index,e.setAttribute("href",`${a}?${$.param(t)}`)}const p=function e({taskId:t,executionDate:a,extraLinks:n,tryNumber:o,isSubDag:p,dagRunId:h,mapIndex:_=-1,isMapped:g=!1,mappedStates:f=[]}){$(".map_index_item").off("click"),$("form[data-action]").off("submit");const b=String(window.location);let x;if($("#btn_filter").on("click",(()=>{window.location=function(e,t,a){const n=new RegExp(`([?&])${t}=.*?(&|$)`,"i"),o=-1!==e.indexOf("?")?"&":"?";return e.match(n)?e.replace(n,`$1${t}=${a}$2`):`${e}${o}${t}=${a}`}(b,"root",t)})),$("#dag_run_id").text(h),$("#task_id").text(t),$("#execution_date").text((0,r.o0)(a)),$("#taskInstanceModal").modal({}),$("#taskInstanceModal").css("margin-top","0"),$("#extra_links").prev("hr").hide(),$("#extra_links").empty().hide(),_>=0?($("#modal_map_index").show(),$("#modal_map_index .value").text(_)):($("#modal_map_index").hide(),$("#modal_map_index .value").text("")),p?($("#div_btn_subdag").show(),x=`${d}.${t}`):$("#div_btn_subdag").hide(),_>=0&&!f.length)$("#modal_map_index").show(),$("#modal_map_index .value").text(_),$("#mapped_dropdown").hide();else if(_>=0||g){$("#modal_map_index").show(),$("#modal_map_index .value").text(""),$("#mapped_dropdown").show();const e=_>-1?_:`All  ${f.length} Mapped Instances`;$("#mapped_dropdown #dropdown-label").text(e),$("#mapped_dropdown .dropdown-menu").empty(),$("#mapped_dropdown .dropdown-menu").append(`<li><a href="#" class="map_index_item" data-mapIndex="all">All ${f.length} Mapped Instances</a></li>`),f.forEach(((e,t)=>{$("#mapped_dropdown .dropdown-menu").append(`<li><a href="#" class="map_index_item" data-mapIndex="${t}">${t} - ${e}</a></li>`)}))}else $("#modal_map_index").hide(),$("#modal_map_index .value").text(""),$("#mapped_dropdown").hide();g?($("#task_actions").text(`Task Actions for all ${f.length} instances`),$("#btn_mapped").show(),$("#mapped_dropdown").css("display","inline-block"),$("#btn_rendered").hide(),$("#btn_xcom").hide(),$("#btn_log").hide(),$("#btn_task").hide()):($("#task_actions").text("Task Actions"),$("#btn_rendered").show(),$("#btn_xcom").show(),$("#btn_log").show(),$("#btn_mapped").hide(),$("#btn_task").show()),$("#dag_dl_logs").hide(),$("#dag_redir_logs").hide(),o>0&&!g&&($("#dag_dl_logs").show(),c&&$("#dag_redir_logs").show()),function({executionDate:e,subDagId:t,taskId:a,mapIndex:n,dagRunId:o}){m(u.subdag,{dag_id:t,execution_date:e}),m(u.task,{dag_id:d,task_id:a,execution_date:e,map_index:n}),m(u.rendered,{dag_id:d,task_id:a,execution_date:e,map_index:n}),m(u.mapped,{_flt_3_dag_id:d,_flt_3_task_id:a,_flt_3_run_id:o,_oc_TaskInstanceModelView:"map_index"}),u.rendered_k8s&&m(u.rendered_k8s,{dag_id:d,task_id:a,execution_date:e,map_index:n});const r={_flt_3_dag_id:d,_flt_3_task_id:a,_oc_TaskInstanceModelView:"dag_run.execution_date"};n>=0&&(r._flt_0_map_index=n),m(u.ti,r),m(u.log,{dag_id:d,task_id:a,execution_date:e,map_index:n}),m(u.xcom,{dag_id:d,task_id:a,execution_date:e,map_index:n})}({executionDate:a,subDagId:x,taskId:t,mapIndex:_,dagRunId:h}),$("#try_index > li").remove(),$("#redir_log_try_index > li").remove();const v=o>2?0:1,w=new URLSearchParams({dag_id:d,task_id:t,execution_date:a,metadata:"null"});void 0!==_&&w.set("map_index",_);for(let e=v;e<o;e+=1){let t=e;0!==e?w.set("try_number",e):t="All",$("#try_index").append(`<li role="presentation" style="display:inline">\n      <a href="${s}?${w}&format=file"> ${t} </a>\n      </li>`),(0!==e||c)&&$("#redir_log_try_index").append(`<li role="presentation" style="display:inline">\n      <a href="${i}?${w}"> ${t} </a>\n      </li>`)}if(w.delete("try_number"),!g&&n&&n.length>0){const e=[];n.sort(),$.each(n,((t,a)=>{w.set("link_name",a);const n=$('<a href="#" class="btn btn-primary disabled"></a>'),o=$('<span class="tool-tip" data-toggle="tooltip" style="padding-right: 2px; padding-left: 3px" data-placement="top" title="link not yet available"></span>');o.append(n),n.text(a),$.ajax({url:`${l}?${w}`,cache:!1,success(e){n.attr("href",e.url),/^(?:[a-z]+:)?\/\//.test(e.url)&&n.attr("target","_blank"),n.removeClass("disabled"),o.tooltip("disable")},error(e){o.tooltip("hide").attr("title",e.responseJSON.error).tooltip("fixTitle")}}),e.push(o)}));const t=$("#extra_links");t.prev("hr").show(),t.append(e).show(),t.find('[data-toggle="tooltip"]').tooltip()}$("form[data-action]").on("submit",(function(e){e.preventDefault();const n=$(this).get(0);(h||a)&&(n.dag_run_id&&(n.dag_run_id.value=h),n.execution_date&&(n.execution_date.value=a),n.origin.value=window.location,n.task_id&&(n.task_id.value=t),n.map_index&&_>=0?n.map_index.value=_:n.map_index&&n.map_index.remove(),n.action=$(this).data("action"),n.submit())})),$(".map_index_item").on("click",(function(){const o=$(this).attr("data-mapIndex");e("all"===o?{taskId:t,executionDate:a,dagRunId:h,extraLinks:n,mapIndex:-1,isMapped:!0,mappedStates:f}:{taskId:t,executionDate:a,dagRunId:h,extraLinks:n,mapIndex:o})}))},h=(0,e.au)("dag_id"),_=(0,e.au)("execution_date"),g=(0,e.au)("dag_run_id"),f=(0,e.au)("arrange"),b=(0,e.au)("task_instances_url"),x=(0,e.au)("is_scheduler_running"),v=new Map,w=`${b}?dag_id=${encodeURIComponent(h)}&execution_date=${encodeURIComponent(_)}`,k={success:!1,running:!1,failed:!1,skipped:!1,upstream_failed:!1,up_for_reschedule:!1,up_for_retry:!1,queued:!1,deferred:!1,no_status:!1},y=()=>!Object.values(taskInstances).map((e=>e.state)).some((e=>-1===["success","failed","upstream_failed","skipped","removed"].indexOf(e))),I=d3.tip().attr("class","tooltip d3-tip").html((e=>e)),A=new dagreD3.graphlib.Graph({compound:!0}).setGraph({nodesep:30,ranksep:15,rankdir:f}).setDefaultEdgeLabel((()=>({lineInterpolate:"basis"}))),S=dagreD3.render(),E=d3.select("#graph-svg");let T=d3.select("#graph-svg g");const z=(e,t)=>{let a=!1,{label:n}=e.value;const o=e.value.isMapped;if(tasks[e.id]&&tasks[e.id].is_mapped||o){const a=o?e.children[0].id:e.id,r=t[a];let d=" ";r&&r.mapped_states&&(d=r.mapped_states.length),n.includes(`[${d}]`)||(n=`${n} [${d}]`)}if(A.node(e.id)&&A.node(e.id).label!==n&&(A.node(e.id).label=n,a=!0),e.children){return e.children.map((e=>z(e,t))).some((e=>e))}return a};function M(e){if(A.hasNode(e)){const t=A.node(e);void 0!==t.children&&t.children.forEach((e=>{M(e.id)}))}A.removeNode(e)}function D(e,t){t.children.forEach((e=>{M(e.id)})),V(t).forEach((t=>v.set(t,e))),t=A.node(e),edges.forEach((e=>{const t=v.get(e.source_id),a=v.get(e.target_id);t===a||A.hasEdge(t,a)||A.setEdge(t,a,{curve:d3.curveBasis,arrowheadClass:"arrowhead"})})),O(),Q(e),function(e,t){const a=ee();K(t).forEach((e=>a.delete(e))),localStorage.setItem(F(),JSON.stringify(Array.from(a)))}(0,t)}function O(){T.remove(),T=E.append("g"),T.call(S,A),T.call(I),d3.selectAll("g.cluster").on("click",(e=>{if(d3.event.defaultPrevented)return;D(e,A.node(e))})),d3.selectAll("g.node").on("click",(e=>{const t=A.node(e);if(void 0!==t.children&&Object.keys(t.children).length>0){if(d3.event.defaultPrevented)return;W(e,t),z(nodes,taskInstances),O(),Q(e)}else if(e in taskInstances){const t=tasks[e],a=taskInstances[e].try_number||0,n=taskInstances[e].mapped_states||[];p({taskId:e,executionDate:_,extraLinks:t.extra_links,tryNumber:a,isSubDag:"SubDagOperator"===t.task_type,dagRunId:g,mapIndex:t.map_index,isMapped:t.is_mapped||!!taskInstances[e].mapped_states,mappedStates:n})}})),d3.selectAll("g.node").on("mouseover",(function(e){d3.select(this).selectAll("rect").attr("data-highlight","highlight"),H(A.predecessors(e)),H(A.successors(e));const t=[e,...A.predecessors(e),...A.successors(e)];d3.selectAll("g.nodes g.node").filter((e=>!t.includes(e))).attr("data-highlight","fade"),d3.selectAll("g.edgePath")[0].forEach((t=>{const a=A.nodeEdges(e).includes(t.__data__)?"highlight":"fade";d3.select(t).attr("data-highlight",a)})),d3.selectAll("g.edgeLabel")[0].forEach((t=>{A.nodeEdges(e).includes(t.__data__)||d3.select(t).attr("data-highlight","fade")}))})),d3.selectAll("g.node").on("mouseout",(function(e){d3.select(this).selectAll("rect, circle").attr("data-highlight",null),R(A.predecessors(e)),R(A.successors(e)),d3.selectAll("g.node, g.edgePath, g.edgeLabel").attr("data-highlight",null),localStorage.removeItem(X())})),B(taskInstances),function(){N=d3.behavior.zoom().on("zoom",(()=>{T.attr("transform",`translate(${d3.event.translate})scale(${d3.event.scale})`)})),E.call(N);const e=A.graph().width,t=A.graph().height,{width:a,height:n}=E.node().viewBox.animVal,o=.05*a,r=.8*Math.min(Math.min(a/e,n/t),C);N.translate([a/2-e*r/2+o,o]),N.scale(r),N.event(T),N.scaleExtent([0,C])}()}let N=null;const C=.3;function H(e){e.forEach((e=>{const t=A.node(e).elem;d3.select(t).selectAll("rect, circle").attr("data-highlight","highlight")}))}function R(e){e.forEach((e=>{const t=A.node(e).elem;d3.select(t).selectAll("rect, circle").attr("data-highlight",null)}))}function U(){d3.selectAll("g.node, g.edgePaths, g.edgeLabel").attr("data-highlight",null),localStorage.removeItem(X())}function j(e,t,a){d3.selectAll("g.node, g.edgePaths, g.edgeLabel").attr("data-highlight","fade"),d3.selectAll(`g.node.${e}`).attr("data-highlight",null),d3.selectAll(`g.node.${e} rect`).attr("data-highlight",null),d3.select(t).style("background-color",a)}function P(e){Object.keys(k).forEach((e=>{({}).hasOwnProperty.call(k,e)&&(k[e]=!1)})),null!=e&&(k[e]=!0)}d3.selectAll(".js-state-legend-item").on("mouseover",(function(){if(!Y()){j($(this).data("state"))}})).on("mouseout",(()=>{Y()||U()})),d3.selectAll(".js-state-legend-item").on("click",(function(){const e=$(this).data("state");if(U(),k[e])P(),d3.selectAll(".js-state-legend-item").style("background-color",null);else{j(e,this,d3.select(this).style("border-color")),P(e)}})),d3.select("#searchbox").on("keyup",(()=>{const e=document.getElementById("searchbox").value;if(""===e)return;let t=null;Y()&&(U(),P()),d3.selectAll("g.nodes g.node").filter((function(a){return""===e?(d3.selectAll("g.edgePaths, g.edgeLabel").attr("data-highlight",null),d3.select(this).attr("data-highlight",null)):(d3.selectAll("g.edgePaths, g.edgeLabel").attr("data-highlight","fade"),!function(e,t){if(e.indexOf(t)>-1)return!0;const a=A.node(e);if(a.children)return!!V(a).find((e=>e.indexOf(t)>-1));return!1}(a,e)?d3.select(this).attr("data-highlight","fade"):(t||(t=this),d3.select(this).attr("data-highlight",null))),null})),t&&Q(t.id,!1)}));const Y=()=>!!Object.keys(k).find((e=>k[e]));let L;function q(){$("#auto_refresh").is(":checked")?L=setInterval((()=>{J()}),1e3*autoRefreshInterval):clearInterval(L)}let Z;function J(){$("#loading-dots").css("display","inline-block"),$.get(w).done((e=>{if(Z!==e){B(e);z(nodes,e)&&O();y()&&($("#auto_refresh").prop("checked",!1),clearInterval(L))}Z=e,setTimeout((()=>{$("#loading-dots").hide()}),500),$("#error").hide()})).fail(((e,t,a)=>{const n=e.responseJSON&&e.responseJSON.error||"Something went wrong.";$("#error_msg").text(`${t}: ${a} ${n}`),$("#error").show(),setTimeout((()=>{$("#loading-dots").hide()}),500),$("#chart_section").hide(1e3),$("#datatable_section").hide(1e3)}))}function G(){const e=localStorage.getItem("disableAutoRefresh"),t=y();$("#auto_refresh").prop("checked",!(e||t)&&"True"===x),q(),d3.select("#refresh_button").on("click",(()=>J()))}function B(a){A.nodes().forEach((n=>{const r=A.node(n),{elem:d}=r,s=n;if(d){const i=`node enter ${function(e,t){const a=A.node(e);if(void 0===a.children)return e in t&&t[e].state||"no_status";const n=V(a),o=new Set;return n.forEach((e=>{if(e in t){const{state:a}=t[e];o.add(null==a?"no_status":a)}})),priority.find((e=>o.has(e)))||"no_status"}(n,a)}`;d.setAttribute("class",i),d.setAttribute("data-toggle","tooltip"),d.onmouseover=n=>{let l;s in a?l=(0,o.default)(a[s],tasks[s]):r.children?l=function(a,n){const o=(0,e.Z2)();let r,d;if(a.isMapped){const e=a.children[0].id,t=n[e].mapped_states.length;[...Array(t).keys()].forEach((e=>{const t=V(a).map((t=>n[t].mapped_states[e])),r=priority.find((e=>t.includes(e)))||"no_status";o.has(r)&&o.set(r,o.get(r)+1)}))}else V(a).forEach((e=>{if(e in n){const t=n[e];r&&!moment(t.start_date).isBefore(r)||(r=moment(t.start_date)),d&&!moment(t.end_date).isAfter(d)||(d=moment(t.end_date));const a=null==t.state?"no_status":t.state;o.has(a)&&o.set(a,o.get(a)+1)}}));const s=convertSecsToHumanReadable(moment(d).diff(r,"second"));let i=`\n    ${a.tooltip?`<p>${a.tooltip}</p>`:""}\n    <strong>Duration:</strong> ${s} <br><br>\n  `;return o.forEach(((e,a)=>{e>0&&(i+=`<strong>${(0,t.escapeHtml)(a)}:</strong> ${e} <br>`)})),i}(r,a):s in tasks&&(l=(0,o.taskNoInstanceTooltip)(s,tasks[s]),d.setAttribute("class",`${i} not-allowed`)),l&&I.show(l,n.target)},d.onmouseout=I.hide,d.onclick=I.hide}}))}function V(e){const t=[];return Object.values(e.children).forEach((e=>{if(void 0===e.children)t.push(e.id);else{V(e).forEach((e=>t.push(e)))}})),t}function K(e){const t=[e.id];return Object.entries(e.children).forEach((([,e])=>{if(void 0!==e.children){K(e).forEach((e=>t.push(e)))}})),t}function F(){return`expandedGroups_${h}`}function X(){return`focused_group_${h}`}function Q(e,t=!0){if(null!=e&&null!=N){const{x:a,y:n}=A.node(e),{width:o,height:r}=E.node().viewBox.animVal;let d=d3.selectAll("g.node").filter((t=>t===e)).select("rect");d.empty()&&(d=d3.selectAll("g.cluster").filter((t=>t===e)).select("rect"));const[s,i]=d3.mouse(E.node()),[l,c]=[d[0][0].attributes.width.value,d[0][0].attributes.height.value],u=.4*Math.min(Math.min(o/l,r/c),C),[m,p]=t?[s,i]:[o/2,r/5],[h,_]=[m-a*u,p+(c/2-n)*u];N.translate([h,_]),N.scale(u),N.event(T);const g=new Set(A.children(e));d3.selectAll("g.nodes g.node").forEach((function(t){t===e||g.has(t)?d3.select(this).attr("data-highlight",null):d3.select(this).attr("data-highlight","fade")})),localStorage.setItem(X(),e)}}function W(e,t){t.children.forEach((t=>{if(A.setNode(t.id,t.value),v.set(t.id,t.id),A.node(t.id).id=t.id,void 0!==t.children){A.node(t.id).children=t.children,V(t).forEach((e=>v.set(e,t.id)))}null!=e&&A.setParent(t.id,e)})),edges.forEach((e=>{const t=v.get(e.source_id),a=v.get(e.target_id);t!==a&&!A.hasEdge(t,a)&&t&&a&&A.setEdge(t,a,{curve:d3.curveBasis,arrowheadClass:"arrowhead",label:e.label})})),A.edges().forEach((t=>{e!==t.v&&e!==t.w||A.removeEdge(t.v,t.w)})),function(e){const t=ee();t.add(e),localStorage.setItem(F(),JSON.stringify(Array.from(t)))}(e)}function ee(){let e;try{e=new Set(JSON.parse(localStorage.getItem(F())))}catch{e=new Set}return e}document.addEventListener("visibilitychange",(()=>{document.hidden?clearInterval(L):G()})),$("#auto_refresh").change((()=>{$("#auto_refresh").is(":checked")?(J(),localStorage.removeItem("disableAutoRefresh")):localStorage.setItem("disableAutoRefresh","true"),q()})),function(){const e=new Set(K(nodes));let t=ee();t=Array.from(t).filter((t=>e.has(t))),localStorage.setItem(F(),JSON.stringify(t))}();const te=localStorage.getItem(X()),ae=ee();W(null,nodes),function e(t,a){void 0!==a.children&&a.children.forEach((a=>{t.has(a.id)&&(W(a.id,A.node(a.id)),e(t,a))}))}(ae,nodes),z(nodes,taskInstances),O(),A.hasNode(te)&&Q(te),G()})(),n})()));